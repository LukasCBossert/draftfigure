%% LaTeX2e file `draftfigure.sty'
%% generated by the `filecontents' environment
%% from source `draftfiguretest' on 2017/05/06.
%%
\NeedsTeXFormat{LaTeX2e}[1994/06/01]
\ProvidesPackage{draftfigure}[2017/05/05]

\RequirePackage{graphicx}
\RequirePackage{etoolbox}
\RequirePackage{xkeyval}
\RequirePackage{calc}

\newbool{df@filename}
\newbool{df@noframe}

\newlength\df@height
\newlength\df@length

\patchcmd{\Gin@setfile}{\expandafter\strip@prefix\meaning\@tempa}{\@draftfigure}{}{}


\providecommand\df@noframe{% NOT WORKING
 \patchcmd\Gin@setfile{\vrule\hss}{\vrule\@width\z@\hss}{}{}%left
 \patchcmd\Gin@setfile{\hss\vrule}{\hss\vrule\@width\z@}{}{}%right
 \patchcmd\Gin@setfile{\hrule\@width}{\hrule\@height\z@\@width}{}{}%top
 \patchcmd\Gin@setfile{\vss\hrule}{\vss\hrule\@height\z@}{}{}%bottom
}

%% Declare a package option
\DeclareOptionX{content}{\def\df@content{#1}}
\DeclareOptionX{filename}[true]{\csuse{bool#1}{df@filename}

}
\DeclareOptionX{size}[normal]{\def\df@size{\csname df@size@#1\endcsname}}
\DeclareOptionX{style}[sf]{\def\df@style{\csname df@style@#1\endcsname}}
\DeclareOptionX{position}[right]{\def\df@position{\csname df@position@#1\endcsname}}
\DeclareOptionX{allfiguresdraft}[true]{\setkeys{Gin}{draft=#1}}
\DeclareOptionX{noframe}[true]{\csuse{bool#1}{df@noframe}\df@noframe
  %https://tex.stackexchange.com/a/94596/98739
 \patchcmd\Gin@setfile{\vrule\hss}{\vrule\@width\z@\hss}{}{}%left
 \patchcmd\Gin@setfile{\hss\vrule}{\hss\vrule\@width\z@}{}{}%right
 \patchcmd\Gin@setfile{\hrule\@width}{\hrule\@height\z@\@width}{}{}%top
 \patchcmd\Gin@setfile{\vss\hrule}{\vss\hrule\@height\z@}{}{}%bottom
}

%% predefined styles
\providecommand\df@style@default{\sffamily}
\providecommand\df@style@sf{\sffamily}
\providecommand\df@style@sc{\scshape}
\providecommand\df@style@bold{\bfseries}
\providecommand\df@style@tt{\tt}
\providecommand\df@style@rm{\rm}

\providecommand\df@size@tiny{\tiny}
\providecommand\df@size@scriptsize{\scriptsize}
\providecommand\df@size@small{\small}
\providecommand\df@size@footnotesize{\footnotesize}
\providecommand\df@size@normal{\normalsize}
\providecommand\df@size@large{\large}
\providecommand\df@size@Large{\Large}
\providecommand\df@size@huge{\huge}
\providecommand\df@size@HUGE{\HUGE}

\providecommand\df@position@top{}
\providecommand\df@position@center{\centering}
\providecommand\df@position@bottom{}
\providecommand\df@position@right{\raggedleft}
\providecommand\df@position@left{\raggedright}

%% Process the options given to the package
\ProcessOptionsX

\define@key{draftfigure}{code}{%
  \def\df@style{#1}}
\define@key{draftfigure}{noframe}[true]{%
  \csuse{bool#1}{df@noframe}
 \df@noframe}
\define@key{draftfigure}{filename}[true]{%
  \csuse{bool#1}{df@filename}}
\define@key{draftfigure}{content}[]{%
  \def\df@content{#1}}
\define@key{draftfigure}{style}[normal]{%
  \def\df@style{\csname df@style@#1\endcsname}}
\define@key{draftfigure}{position}[normal]{%
   \def\df@position{\csname df@position@#1\endcsname}}
\define@key{draftfigure}{size}[sf]{%
  \def\df@size{\csname df@size@#1\endcsname}}

\newcommand\setdf[1]{%
  \setkeys{draftfigure}{#1}}



\def\@draftfigure{%
\setlength\df@length{\Gin@req@width}%
\setlength\df@height{\Gin@nat@height}%
\begin{minipage}[c][\df@height][c]{\df@length - 1em}
  \df@position%
  \df@size%
 \df@style%
  \df@content%
 \ifbool{df@filename}{%
   \ifdefined\df@content%
   {\mbox{~}\\[\baselineskip]}%
  {}
  \expandafter\strip@prefix\meaning\@tempa}
 {}%
\end{minipage}}%
\endinput
