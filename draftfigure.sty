%% LaTeX2e file `draftfigure.sty'
%% generated by the `filecontents' environment
%% from source `draftfiguretest' on 2017/05/06.
%%
\NeedsTeXFormat{LaTeX2e}[1994/06/01]
\ProvidesPackage{draftfigure}[2017/05/05]

\RequirePackage{graphicx}
\RequirePackage{etoolbox}
\RequirePackage{xkeyval}

\newbool{df@filename}
\newbool{df@noframe}

\newlength\df@height
\newlength\df@length

\patchcmd{\Gin@setfile}{\expandafter\strip@prefix\meaning\@tempa}{\@draftfigure}{}{}

\providecommand*\df@font{\normalsize}
\providecommand*\df@style{\sffamily}
\providecommand*\df@content{}
\providecommand\df@noframe{% NOT WORKING
 \patchcmd\Gin@setfile{\vrule\hss}{\vrule\@width\z@\hss}{}{}%left
 \patchcmd\Gin@setfile{\hss\vrule}{\hss\vrule\@width\z@}{}{}%right
 \patchcmd\Gin@setfile{\hrule\@width}{\hrule\@height\z@\@width}{}{}%top
 \patchcmd\Gin@setfile{\vss\hrule}{\vss\hrule\@height\z@}{}{}%bottom
}

%% Declare a package option
\DeclareOptionX{content}{\def\df@content{#1}}
\DeclareOptionX{filename}[true]{\csuse{bool#1}{df@filename}

}
\DeclareOptionX{font}{\def\df@font{\csname #1\endcsname}}
\DeclareOptionX{style}{\def\df@style{\csname df@style@#1\endcsname}}
\DeclareOptionX{allfiguresdraft}{\setkeys{Gin}{draft=true}}
\DeclareOptionX{noframe}[true]{\csuse{bool#1}{df@noframe}\df@noframe
  %https://tex.stackexchange.com/a/94596/98739
 \patchcmd\Gin@setfile{\vrule\hss}{\vrule\@width\z@\hss}{}{}%left
 \patchcmd\Gin@setfile{\hss\vrule}{\hss\vrule\@width\z@}{}{}%right
 \patchcmd\Gin@setfile{\hrule\@width}{\hrule\@height\z@\@width}{}{}%top
 \patchcmd\Gin@setfile{\vss\hrule}{\vss\hrule\@height\z@}{}{}%bottom
}

%% predefined styles
\providecommand\df@style@default{\sffamily}
\providecommand\df@style@sf{\sffamily}
\providecommand\df@style@sc{\scshape}
\providecommand\df@style@bold{\bfseries}
\providecommand\df@style@tt{\tt}
\providecommand\df@style@rm{\rm}

\providecommand\df@font@tiny{\tiny}
\providecommand\df@font@scriptsize{\scriptsize}
\providecommand\df@font@small{\small}
\providecommand\df@font@footnotesize{\footnotesize}
\providecommand\df@font@normal{\normalsize}
\providecommand\df@font@large{\large}
\providecommand\df@font@Large{\Large}
\providecommand\df@font@huge{\huge}
\providecommand\df@font@HUGE{\HUGE}


%% Process the options given to the package
\ProcessOptionsX

\define@key{draftfigure}{code}{%
  \def\df@style{#1}}
\define@key{draftfigure}{noframe}[true]{%
  \csuse{bool#1}{df@noframe}
 \df@noframe}
\define@key{draftfigure}{filename}[true]{%
  \csuse{bool#1}{df@filename}}
\define@key{draftfigure}{content}[]{%
  \def\df@content{#1}}
\define@key{draftfigure}{style}[normal]{%
  \def\df@style{\csname df@style@#1\endcsname}}
\define@key{draftfigure}{font}[sf]{%
  \def\df@font{\csname df@font@#1\endcsname}}

\newcommand\setdf[1]{%
  \setkeys{draftfigure}{#1}}



\def\@draftfigure{%
\setlength\df@length{\Gin@req@width}%
\setlength\df@height{\Gin@nat@height}%
\begin{minipage}[\df@height]{\df@length}
  %\centering
  \df@font%
 \df@style%
  \df@content%
 \ifbool{df@filename}{\mbox{~}\\[\baselineskip]\expandafter\strip@prefix\meaning\@tempa}{}%
\end{minipage}}%
\endinput
