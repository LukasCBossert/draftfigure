% !TEX root = draftfigure.tex
\usepackage{iftex}
\ifPDFTeX
  \usepackage[utf8]{inputenc}
  \usepackage[T1]{fontenc}
  \usepackage{lmodern}
\else
    \ifXeTeX
    \usepackage{fontspec}
		\def\compiler{\hologo{XeLaTeX}}
  \else 
	  \usepackage{fontspec}
    \usepackage{luatextra}
    \usepackage{luaotfload}
	\def\compiler{\hologo{LuaLaTeX}}
\fi
  \defaultfontfeatures{Ligatures=TeX}
\fi
\listfiles
 \usepackage[oldstyle]{libertine}
\defaultfontfeatures[AnonymousPro]
  {
    Extension      = .ttf           ,
    BoldFont       = AnonymousPro-Bold          ,
    ItalicFont     = AnonymousPro-BoldItalic    ,
    BoldItalicFont = AnonymousPro-Italic        ,
    UprightFont    = AnonymousPro-Regular       ,
  }
\setmonofont[Scale= MatchUppercase]{AnonymousPro}



\usepackage{url}
\usepackage{xspace}
\usepackage{draftfigure}
\usepackage{metalogo}
\usepackage{hologo}
\usepackage{babel}


\newlength{\ratio}
\newlength{\wrapfiguremargin}

\setlength{\ratio}{2cm}
\usepackage{lscape}%landscape-Modus
\usepackage[					% page layout modifications
	paper=a4paper,					% 	- use A4 paper size
%    head=.5\ratio,
	foot=.25\ratio,
	left=2\ratio,					% 	- total body: left margin (odd pages)
	top=1.5\ratio,						% 	- total body: top margin
	right=2\ratio,					% 	- total body: right margin (odd pages)
	bottom=\ratio,					% 	- total body: bottom margin
%	marginpar=3.5cm,			% 	- width for side note
	marginparwidth=1.5\ratio,			% 	- width for side note
	marginparsep=.25\ratio,				% 	- space between notes and body text (content)
]{geometry}


\usepackage[
  autostyle=true,%
]{csquotes}
\usepackage{multicol}
  \setlength{\columnsep}{1.5cm}
  \setlength{\columnseprule}{0.2pt}

\usepackage{xcolor}
\definecolor{codeblue}{RGB}{0,65,137}
\definecolor{codegreen}{RGB}{147,193,26}
\definecolor{codegray}{rgb}{0.5,0.5,0.5}
\definecolor{codepurple}{rgb}{0.58,0,0.82}
\definecolor{backcolour}{rgb}{0.95,0.95,0.92}


\usepackage[ 
	headsepline, 
	footsepline,
%	plainfootsepline, 
%markcase=upper, 
automark, 
draft=false,
]{scrlayer-scrpage} 
\pagestyle{scrheadings}
\clearscrheadfoot
\addtokomafont{pageheadfoot}{\normalfont\footnotesize\sffamily\color{black!50}}

\lohead{\texttt{draftfigure \dfdate v\dfversion}}%
\rohead{\copyright\ by Lukas C. Bossert}
\rofoot{\textbf{\sffamily \thepage}}
\lofoot{\href{http://www.digitales-altertum.de}{digitales-altertum.de}}


\usepackage{enumitem}
\setlength{\parindent}{0pt}
\setlength{\parskip}{6pt plus 2pt minus 2pt}
\setenumerate[1]{label=(\alph*),leftmargin=*,nolistsep,parsep=\parskip}
\usepackage{float}
\usepackage{caption}

\usepackage[%
  xparse,
  skins,%
  listings,%
  breakable,%
]{tcolorbox}
\lstMakeShortInline{|}

 

\newtcblisting[
auto counter,
]{code}{%
  before skip=2em,after skip=2em,
    listing only,
    breakable,
    top=0.2pt,
    bottom=0.2pt,
    colback=codegreen!10,
    colframe=codegreen,
    left=5pt,
    right=5pt,
      sharp corners,
    boxrule=0pt,
    bottomrule=0pt,
    toprule=0pt,
    enhanced jigsaw,
    listing options={%style=tcblatex,
%        numbers=left,
        numberstyle=\tiny\color{codeblue},
        moredelim={[is][keywordstyle]{@@}{@@}},
        basicstyle=\small\ttfamily,
        breaklines=true,
        breakautoindent=false,
        breakindent=0pt,
        escapeinside={{*@}{@*}},
    },%
    lefttitle=0pt,
    coltitle=codeblue,
    colbacktitle=codegreen!10,
%    fonttitle=\bfseries\footnotesize,
%    title={Example \thetcbcounter:  #2}, 
%   #1,%  
%    borderline north={1pt}{14.4pt}{codegreen,dashed},
}



\newtcolorbox{marker}[1][]{
enhanced,
  before skip=2mm,after skip=3mm,
  boxrule=0.4pt,left=5mm,right=2mm,top=1mm,bottom=1mm,
  colback=backcolour,
  colframe=yellow!20!black,
  sharp corners,rounded corners=southeast,arc is angular,arc=3mm,
  underlay={%
    \path[fill=tcbcol@back!80!black] ([yshift=3mm]interior.south east)--++(-0.4,-0.1)--++(0.1,-0.2);
    \path[draw=tcbcol@frame,shorten <=-0.05mm,shorten >=-0.05mm] ([yshift=3mm]interior.south east)--++(-0.4,-0.1)--++(0.1,-0.2);
    \path[fill=red!50!black,draw=none] (interior.south west) rectangle node[white]{\Huge\bfseries !} ([xshift=4mm]interior.north west);
    },
  drop fuzzy shadow,#1
  }
  
\newtcolorbox{examplebox}[1][]{examplebox}

\tcbset{examplebox/.style={%
  before skip=2em,after skip=2em,
  boxrule=0pt,
  bottomrule=2pt,
  toprule=2pt,
 colframe=codeblue,
  colback=codegreen!10,
   coltitle=codegreen!10,%  coltitle=codeblue,
  bicolor,
      sharp corners,
 fontupper=\small\ttfamily,
  colbacklower=codeblue!10,
  fonttitle=\sffamily\bfseries,
  }}



\newtcblisting{codeexample}{%
before skip=\baselineskip,
examplebox,
breakable,
%  sidebyside,
listing and text,
}

%------ changelog
\usepackage{xparse,tabularx}

\ExplSyntaxOn

\NewDocumentCommand{\AddRevision}{mmm}
 {
  \draftfigure_revision_add:nnn { #1 } { #2 } { #3 }
 }
\NewDocumentCommand{\PrintRevisions}{}
 {
  \begin{center}
  \cs_set_eq:NN \__draftfigure_revision_do:nnn \draftfigure_revision_date:nnn
  \seq_set_eq:NN \l__draftfigure_revision_temp_seq \g_draftfigure_revision_list_seq
  \seq_sort:Nn \l__draftfigure_revision_temp_seq
   {
    \int_compare:nNnTF
     { ##1 } > { ##2 }
     { \sort_return_same: }
     { \sort_return_swapped: }
   }
  \cs_set_eq:NN \__draftfigure_revision_do:nnn \draftfigure_revision_entry:nnn
  \int_gset:Nn \g__draftfigure_revision_entry_int { \seq_count:N \l__draftfigure_revision_temp_seq }
  \tl_clear:N \l__draftfigure_revision_tablebody_tl
  \seq_map_inline:Nn \l__draftfigure_revision_temp_seq
   {
    \int_gdecr:N \g__draftfigure_revision_entry_int
    \tl_put_right:Nf \l__draftfigure_revision_tablebody_tl
     { \int_to_arabic:n { \g__draftfigure_revision_entry_int } ##1 }
   }
  \begin{tabularx}{\textwidth}{llXr}
  \multicolumn{4}{l}{Revisions} \\
  \hline
  \tl_use:N \l__draftfigure_revision_tablebody_tl
  \hline
  \end{tabularx}
  \end{center}
 }

\seq_new:N \g_draftfigure_revision_list_seq
\seq_new:N \l__draftfigure_revision_temp_seq
\int_new:N \g__draftfigure_revision_entry_int
\tl_new:N \l__draftfigure_revision_tablebody_tl
\cs_generate_variant:Nn \tl_put_right:Nn { Nf }

\cs_new_protected:Nn \draftfigure_revision_add:nnn
 {
  \seq_gput_right:Nn \g_draftfigure_revision_list_seq
   {
    \__draftfigure_revision_do:nnn { #1 } { #2 } { #3 }
   }
 }

\cs_new:Nn \draftfigure_revision_entry:nnn
 {
   & #1 & #2 & #3 \\
 }

\cs_new:Nn \draftfigure_revision_date:nnn
 {
  \__draftfigure_revision_make_date:w #1 \q_stop
 }
\cs_new:Npn \__draftfigure_revision_make_date:w #1-#2-#3 \q_stop
 {
  #1#2#3
 }
\ExplSyntaxOff
%--------

\usepackage{hyperxmp}
\usepackage{hyperref}
\hypersetup{					% setup the hyperref-package options
  unicode       = true,
	pdftitle      = {draftfigure},	% 	- title (PDF meta)
	pdfsubject    = {},% 	- subject (PDF meta)
	pdfauthor      = {Lukas C. Bossert},	% 	- author (PDF meta)
	pdfauthortitle = {},
	pdfcopyright   = {This work may be distributed and/or modified under the
        conditions of the LaTeX Project Public License, either version 1.3
        of this license or (at your option) any later version.},
	pdfhighlight   = /N,
	pdfdisplaydoctitle = true,
	pdfdate        = {\the\year-\the\month-\the\day}
	pdflang        = {en},
	pdfcaptionwriter = {Lukas C. Bossert},
	pdfkeywords    = {},
	pdfproducer={LuaLaTeX},
	pdflicenseurl  = {http://www.latex-project.org/lppl.txt},
	plainpages     = false,			% 	- 
  colorlinks     = true, %Colours links instead of ugly boxes
  urlcolor       = codeblue, %Colour for external hyperlinks
  linkcolor      = codeblue, %Colour of internal links
  citecolor      = black, %Colour of citations
  linktoc        = page,
  pdfborder      = {0 0 0},			% 	-
	breaklinks     = true,			% 	- allow line break inside links
	bookmarksnumbered  = true,		%
	bookmarksopenlevel = 4,
	bookmarksopen  = true,		%
	final          = true
}
\usepackage{bookmark}
\usepackage{cleveref}

\crefformat{lstlisting}{#2example\ #1#3}
\Crefformat{lstlisting}{#2Example #1#3}
\crefmultiformat{lstlisting}{#2examples #1#3}{; #2#1#3}{; #2#1#3}{; #2#1#3}
\Crefmultiformat{lstlisting}{#2Examples #1#3}{; #2#1#3}{; #2#1#3}{; #2#1#3}
\Crefrangeformat{lstlisting}{#3Examples #1#4--#5#2#6}
\crefrangeformat{lstlisting}{#3examples #1#4--#5#2#6}
